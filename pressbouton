#include <p18f4550.inc>   

    ORG     0x00            
    GOTO    main               

init:
    CLRF    PORTC              ; Met toutes les sorties du PORTC à 0
    CLRF    LATC               ; Valeur logique à 0
    CLRF    TRISC              ; PORTC configuré en sortie (LED)
    BSF     TRISD, 0           ; RD0 configuré en entrée (bouton)
    RETURN

main:
    CALL    init               ; Appel initialisation

main_loop:
    BTFSS   PORTD, 0           ; Teste le bit RD0 : 1 = bouton appuyé ?
    GOTO    no_press           ; Si non, saute à no_press

    ; ----- BOUTON PRESSÉ -----
    BSF     LATC, 0            ; Allume la LED
    CALL    debounce_delay     ; Petite temporisation anti-rebond
wait_release:
    BTFSC   PORTD, 0           ; Attends que le bouton soit relâché
    GOTO    wait_release
    BCF     LATC, 0            ; Éteint la LED
    GOTO    main_loop

no_press:
    BCF     LATC, 0            ; Assure que la LED reste éteinte
    GOTO    main_loop


; SECTION DÉLAI (ANTI-REBOND)
debounce_delay:
    MOVLW   D'255'
    MOVWF   count1
delay_loop1:
    MOVLW   D'255'
    MOVWF   count2
delay_loop2:
    DECFSZ  count2, F
    GOTO    delay_loop2
    DECFSZ  count1, F
    GOTO    delay_loop1
    RETURN


; VARIABLES

count1      EQU     0x20
count2      EQU     0x21

    END
